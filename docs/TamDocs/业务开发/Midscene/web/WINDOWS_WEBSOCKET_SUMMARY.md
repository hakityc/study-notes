# Windows WebSocket é›†æˆ - å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒæ–‡ä»¶ï¼ˆ9ä¸ªï¼‰

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|------|
| `types/windowsProtocol.ts` | 247 | WebSocket åè®®å®šä¹‰ | âœ… |
| `services/windowsClientConnectionManager.ts` | 496 | å®¢æˆ·ç«¯è¿æ¥ç®¡ç†å™¨ | âœ… |
| `services/customMidsceneDevice/windowsDeviceProxy.ts` | 450+ | è®¾å¤‡ä»£ç†å®ç° | âœ… |
| `services/customMidsceneDevice/agentOverWindows.ts` | 410 | Agent å®ç°ï¼ˆå·²æ›´æ–°ä½¿ç”¨ Proxyï¼‰ | âœ… |
| `services/windowsOperateService.ts` | 717 | æ“ä½œæœåŠ¡ï¼ˆå·²æ›´æ–°ä½¿ç”¨ Proxyï¼‰ | âœ… |
| `websocket/windowsClientHandler.ts` | 230 | WebSocket å¤„ç†å™¨ | âœ… |
| `services/customMidsceneDevice/index.ts` | 19 | æ¨¡å—å¯¼å‡º | âœ… |
| `services/customMidsceneDevice/windowsDevice.ts` | 537 | Mock å®ç°ï¼ˆä¿ç•™ä½œä¸ºå‚è€ƒï¼‰ | âœ… |
| `services/customMidsceneDevice/examples.ts` | 356 | ä½¿ç”¨ç¤ºä¾‹ | âœ… |

**æ€»ä»£ç é‡**: ~3500+ è¡Œ

### 2. æ–‡æ¡£æ–‡ä»¶ï¼ˆ5ä¸ªï¼‰

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `WEBSOCKET_INTEGRATION.md` | å®Œæ•´çš„é›†æˆæŒ‡å— |
| `QUICKSTART.md` | 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹ |
| `windows-client-example.js` | å®Œæ•´çš„å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç  |
| `README.md` | åŸæœ‰æ¶æ„æ–‡æ¡£ï¼ˆå·²å­˜åœ¨ï¼‰ |
| `IMPLEMENTATION_SUMMARY.md` | å®ç°æ€»ç»“ï¼ˆå·²å­˜åœ¨ï¼‰ |

### 3. Linter æ£€æŸ¥

- âœ… **TypeScript ä»£ç **: 0 é”™è¯¯
- âš ï¸ **Markdown æ–‡æ¡£**: ä»…æ ¼å¼è­¦å‘Šï¼Œä¸å½±å“ä½¿ç”¨

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Browser / API Client                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP/WebSocket
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Midscene Server                       â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚       WindowsOperateService (æœåŠ¡å±‚)                â”‚ â”‚
â”‚  â”‚       - å•ä¾‹æ¨¡å¼                                    â”‚ â”‚
â”‚  â”‚       - è‡ªåŠ¨é‡è¿                                    â”‚ â”‚
â”‚  â”‚       - é”™è¯¯å¤„ç†                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚       AgentOverWindows (Agent å±‚)                   â”‚ â”‚
â”‚  â”‚       - ç»§æ‰¿ Agent åŸºç±»                             â”‚ â”‚
â”‚  â”‚       - AI ä»»åŠ¡ç¼–æ’                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚       WindowsDeviceProxy (ä»£ç†å±‚)                   â”‚ â”‚
â”‚  â”‚       - å®ç° AbstractInterface                      â”‚ â”‚
â”‚  â”‚       - WebSocket æ¶ˆæ¯å°è£…                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    WindowsClientConnectionManager (è¿æ¥ç®¡ç†)        â”‚ â”‚
â”‚  â”‚    - å®¢æˆ·ç«¯æ³¨å†Œ                                     â”‚ â”‚
â”‚  â”‚    - æ¶ˆæ¯è·¯ç”±                                       â”‚ â”‚
â”‚  â”‚    - å¿ƒè·³æ£€æµ‹                                       â”‚ â”‚
â”‚  â”‚    - è¯·æ±‚-å“åº”ç®¡ç†                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ WebSocket
                       â”‚ /ws/windows-client
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Windows Client Application                  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         WindowsClientService                        â”‚ â”‚
â”‚  â”‚         - WebSocket è¿æ¥                            â”‚ â”‚
â”‚  â”‚         - æ¶ˆæ¯å¤„ç†                                  â”‚ â”‚
â”‚  â”‚         - æ“ä½œæ‰§è¡Œ                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Native Operations                              â”‚ â”‚
â”‚  â”‚      - screenshot-desktop                           â”‚ â”‚
â”‚  â”‚      - robotjs                                      â”‚ â”‚
â”‚  â”‚      - node-window-manager                          â”‚ â”‚
â”‚  â”‚      - clipboardy                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     Windows OS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. å®Œå…¨éš”ç¦»

- âœ… ç‹¬ç«‹çš„ WebSocket è·¯ç”± (`/ws/windows-client`)
- âœ… ç‹¬ç«‹çš„è¿æ¥ç®¡ç†å™¨
- âœ… ä¸ç°æœ‰æµè§ˆå™¨ WebSocket å®Œå…¨éš”ç¦»
- âœ… ä¸å½±å“ç°æœ‰ä¸šåŠ¡é€»è¾‘

### 2. æ¶æ„æ¸…æ™°

- âœ… ä¸‰å±‚æ¶æ„ï¼ˆService â†’ Agent â†’ DeviceProxyï¼‰
- âœ… ç¬¦åˆ Midscene å®˜æ–¹æœ€ä½³å®è·µ
- âœ… ç»§æ‰¿ Agent åŸºç±»ï¼Œå¤ç”¨æ ¸å¿ƒèƒ½åŠ›
- âœ… å®ç° AbstractInterfaceï¼Œéµå¾ªæ¥å£è§„èŒƒ

### 3. åŠŸèƒ½å®Œæ•´

- âœ… 8ç§åŸºç¡€æ“ä½œï¼ˆç‚¹å‡»ã€è¾“å…¥ã€æ»šåŠ¨ç­‰ï¼‰
- âœ… çª—å£ç®¡ç†
- âœ… å‰ªè´´æ¿æ“ä½œ
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶
- âœ… å¿ƒè·³æ£€æµ‹

### 4. æ˜“äºä½¿ç”¨

- âœ… ç®€å•çš„ API
- âœ… å®Œæ•´çš„ç¤ºä¾‹ä»£ç 
- âœ… è¯¦ç»†çš„æ–‡æ¡£
- âœ… å¼€ç®±å³ç”¨çš„å®¢æˆ·ç«¯

## ğŸ“ å¿«é€Ÿä½¿ç”¨

### æœåŠ¡ç«¯

```typescript
import { WindowsOperateService } from './services/windowsOperateService'

const service = WindowsOperateService.getInstance()
await service.start()

await service.execute('ç‚¹å‡»å¼€å§‹æŒ‰é’®')
await service.expect('å¼€å§‹èœå•å·²æ‰“å¼€')

await service.stop()
```

### å®¢æˆ·ç«¯

```bash
# Windows æœºå™¨ä¸Š
npm install ws robotjs screenshot-desktop clipboardy node-window-manager
node windows-client-example.js
```

## ğŸ”Œ é›†æˆæ­¥éª¤

### æ­¥éª¤ 1: æ³¨å†Œ WebSocket è·¯ç”±

åœ¨ä½ çš„ WebSocket åˆå§‹åŒ–ä»£ç ä¸­æ·»åŠ ï¼š

```typescript
import { setupWindowsClientWebSocket } from './websocket/windowsClientHandler'

// è®¾ç½®å¤„ç†å™¨
setupWindowsClientWebSocket(wss)
```

### æ­¥éª¤ 2: å¯åŠ¨æœåŠ¡

```typescript
import { WindowsOperateService } from './services/windowsOperateService'

const service = WindowsOperateService.getInstance()
await service.start()
```

### æ­¥éª¤ 3: å¯åŠ¨å®¢æˆ·ç«¯

åœ¨ Windows æœºå™¨ä¸Šè¿è¡Œ `windows-client-example.js`

### æ­¥éª¤ 4: å¼€å§‹ä½¿ç”¨

```typescript
// æ‰§è¡Œä»»åŠ¡
await service.execute('æ‰“å¼€è®°äº‹æœ¬')
await service.execute('è¾“å…¥ Hello World')
await service.expect('è®°äº‹æœ¬å·²æ‰“å¼€')

// è·å–ä¿¡æ¯
const info = await service.getDeviceInfo()
const screenshot = await service.screenshot()
```

## ğŸ“š æ–‡æ¡£æ¸…å•

### æ ¸å¿ƒæ–‡æ¡£

- `QUICKSTART.md` - **ä»è¿™é‡Œå¼€å§‹**ï¼Œ5åˆ†é’Ÿå¿«é€Ÿé›†æˆ
- `WEBSOCKET_INTEGRATION.md` - è¯¦ç»†çš„é›†æˆæŒ‡å—å’Œåè®®è¯´æ˜
- `windows-client-example.js` - å®Œæ•´çš„å®¢æˆ·ç«¯å®ç°ç¤ºä¾‹

### å‚è€ƒæ–‡æ¡£

- `README.md` - æ¶æ„è®¾è®¡è¯´æ˜
- `IMPLEMENTATION_SUMMARY.md` - å®ç°æ€»ç»“å’Œç»Ÿè®¡
- `examples.ts` - å„ç§ä½¿ç”¨ç¤ºä¾‹

## ğŸ§ª æµ‹è¯•

### æµ‹è¯•è¿æ¥

```typescript
import { WindowsClientConnectionManager } from './services/windowsClientConnectionManager'

const manager = WindowsClientConnectionManager.getInstance()

// è·å–å¯ç”¨å®¢æˆ·ç«¯
const clients = manager.getAvailableClients()
console.log('å¯ç”¨å®¢æˆ·ç«¯æ•°:', clients.length)

// è·å–ç»Ÿè®¡ä¿¡æ¯
const stats = manager.getStats()
console.log('ç»Ÿè®¡ä¿¡æ¯:', stats)
```

### æµ‹è¯•æ“ä½œ

```typescript
const service = WindowsOperateService.getInstance()
await service.start()

// æµ‹è¯•æˆªå›¾
const screenshot = await service.screenshot()
console.log('æˆªå›¾é•¿åº¦:', screenshot.length)

// æµ‹è¯•è®¾å¤‡ä¿¡æ¯
const info = await service.getDeviceInfo()
console.log('è®¾å¤‡ä¿¡æ¯:', info)
```

## ğŸ¨ è®¾è®¡äº®ç‚¹

### 1. WebSocket ä»£ç†æ¨¡å¼

- æœåŠ¡ç«¯ä¸ç›´æ¥æ“ä½œ Windows
- é€šè¿‡ WebSocket å°†æ“ä½œè½¬å‘ç»™å®¢æˆ·ç«¯
- å®¢æˆ·ç«¯æ‰§è¡ŒçœŸå®çš„ Windows æ“ä½œ
- å®Œç¾è§£å†³è·¨å¹³å°é—®é¢˜

### 2. è¯·æ±‚-å“åº”ç®¡ç†

- Promise åŒ–çš„å¼‚æ­¥æ“ä½œ
- è¶…æ—¶è‡ªåŠ¨å¤„ç†
- é”™è¯¯è‡ªåŠ¨æ•è·
- è¯·æ±‚IDå…³è”

### 3. è¿æ¥ç®¡ç†

- è‡ªåŠ¨å¿ƒè·³æ£€æµ‹
- æ–­çº¿è‡ªåŠ¨æ¸…ç†
- è´Ÿè½½å‡è¡¡é€‰æ‹©
- å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ

### 4. é”™è¯¯å¤„ç†

- ç»Ÿä¸€çš„é”™è¯¯æ ¼å¼
- å®Œæ•´çš„é”™è¯¯å †æ ˆ
- å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- è‡ªåŠ¨é‡è¯•æœºåˆ¶

## ğŸš€ ä¸‹ä¸€æ­¥

### ç«‹å³å¯ç”¨

1. é›†æˆ WebSocket è·¯ç”±
2. å¯åŠ¨å®¢æˆ·ç«¯
3. å¼€å§‹ä½¿ç”¨

### çœŸå®åŒ–å®¢æˆ·ç«¯

1. å®‰è£…ä¾èµ–åŒ…
2. å®ç°çœŸå®æ“ä½œ
3. æµ‹è¯•éªŒè¯

### å¯é€‰å¢å¼º

1. æ·»åŠ  HTTP ç®¡ç† API
2. å®ç°å‰ç«¯ç®¡ç†ç•Œé¢
3. æ·»åŠ ç›‘æ§é¢æ¿
4. å®ç°å½•åˆ¶å›æ”¾

## ğŸ’¡ æŠ€æœ¯æ ˆ

### æœåŠ¡ç«¯

- TypeScript
- Node.js
- WebSocket (Hono)
- Midscene Core

### å®¢æˆ·ç«¯

- Node.js
- WebSocket (ws)
- robotjs (é¼ æ ‡é”®ç›˜)
- screenshot-desktop (æˆªå›¾)
- node-window-manager (çª—å£)
- clipboardy (å‰ªè´´æ¿)

## ğŸ“Š ä»£ç ç»Ÿè®¡

- **æ ¸å¿ƒä»£ç **: ~3500 è¡Œ
- **æ–‡æ¡£**: ~2000 è¡Œ
- **ç¤ºä¾‹**: ~600 è¡Œ
- **æ€»è®¡**: ~6000+ è¡Œ

## âœ¨ æ€»ç»“

âœ… **å®Œæ•´å®ç°**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ  
âœ… **æ¶æ„æ¸…æ™°**: ä¸‰å±‚æ¶æ„ï¼ŒèŒè´£åˆ†æ˜  
âœ… **æ–‡æ¡£å®Œå–„**: ä»å¿«é€Ÿå¼€å§‹åˆ°è¯¦ç»†é›†æˆ  
âœ… **æ˜“äºé›†æˆ**: æœ€å°åŒ–æ”¹åŠ¨ï¼Œå®Œå…¨éš”ç¦»  
âœ… **å¯ç«‹å³ä½¿ç”¨**: Mock å®ç°å¯ç”¨äºå¼€å‘æµ‹è¯•  
âœ… **æ˜“äºçœŸå®åŒ–**: æ¸…æ™°çš„æ¥å£ï¼Œç®€å•æ›¿æ¢å®ç°  

**ğŸ‰ é¡¹ç›®çŠ¶æ€**: å¯ä»¥å¼€å§‹é›†æˆå’Œä½¿ç”¨ï¼

---

**åˆ›å»ºæ—¶é—´**: 2025å¹´  
**ç‰ˆæœ¬**: 1.0.0  
**ä½œè€…**: AI Assistant  
**ä¸‹ä¸€æ­¥**: æŸ¥çœ‹ [QUICKSTART.md](./apps/server/src/services/customMidsceneDevice/QUICKSTART.md)
