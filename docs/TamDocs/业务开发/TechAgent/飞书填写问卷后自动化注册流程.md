# 🚀 飞书填写问卷后自动化注册流程

## ❓ 背景与问题  

过去，我们的系统采用 **邀请制**，用户填写问卷后，需要 **人工审核并手动录入数据** 进行注册。  
这一流程虽然确保了用户质量，但存在 **效率低、人工操作易出错** 等问题。  

因此，我们决定 **引入自动化流程**，以提升注册效率并减少人工干预。  

### 主要问题

1. **我们的系统如何自动获取飞书问卷信息？**  
2. **用户注册时填写的邮箱与问卷中的邮箱不一致怎么办？**  
3. **注册链接明文email和code不太安全怎么办？**
4. **如何确保整个流程安全可靠？**  

---

## ✅ 解决方案  

### 📥 自动获取飞书问卷信息  

🛠️ **飞书自动化（Webhook/机器人）** 用于监听问卷提交，并自动发送 HTTP 请求到后端。  
💡 后端接口接收请求，提取用户的邮箱信息，并触发 **注册邮件发送流程**。

---

### ✉️ 自动发送注册邀请邮件  

📨 **后端生成注册链接，并自动发送邮件**：  

1. **后端生成唯一 `code`**  
   - 服务器在收到问卷信息后，为用户生成一个唯一的 **`code`** 作为身份校验标识。  
   - 该 `code` 与用户的 **邮箱** 绑定，并存入数据库。  

2. **构造注册链接**  
   - 注册链接格式示例：  

     `https://example.com/register?email=user@example.com&code=123456`

   - 该链接包含 **用户邮箱和唯一 `code`**，用于注册验证。

3. **邮件自动发送**  
   - 系统自动向用户填写的邮箱发送 **注册邀请邮件**，邮件内容包括：  
     ✅ 注册流程说明  
     ✅ 一键跳转的 **注册链接**（带 `code`）  
     ✅ 可能的有效期提示  

---

### 🔒 安全性与安全性

1. **后端生成链接的时候，对`email=xxx@qq.com&code=123456`进行加密**
2. **前端获取链接，解密出`email=xxx@qq.com&code=123456`**

---

### 🔄 用户注册流程  

1. **用户点击注册链接，跳转至前端注册页面**  
2. **前端提交 `{邮箱, 密码, code}` 进行注册**  
3. **后端验证 `code`，匹配成功后完成注册 🎉**  

---

## 🎯 方案优势  

✅ **🚀 全自动化，减少人工操作**：  

- 问卷提交后，系统 **自动获取数据**、**自动生成邀请**、**自动发送邮件**，省去手动录入的繁琐步骤。  

✅ **🔒 安全性提升**：  

- 通过 `code` 绑定邮箱，确保只有填写问卷的用户可以注册，防止滥用。  
- 限制 **注册链接有效期**，避免链接长期可用导致安全风险。  

✅ **💡 更好的用户体验**：  

- 用户收到邮件后 **直接点击链接即可注册**，流程更流畅，无需等待人工审核。  

---
